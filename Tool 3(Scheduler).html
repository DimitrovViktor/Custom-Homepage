<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scheduler</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/ryanoasis/nerd-fonts@3.0.1/css/nerd-fonts.min.css">
    <style>
        :root {

            --text-color: #f0f8ff;
            --accent-color: #00bcd4;
            --link-color: #4dd0e1;
            --bg-outer: rgba(30, 30, 40, 0.85);
            --content-bg: rgba(25, 25, 35, 0.8);
            --content-border: rgba(0, 188, 212, 0.3);
            --content-shadow: rgba(0, 0, 0, 0.6);
            --accent-1: #00bcd4;
            --accent-2: #4dd0e1;
            --accent-3: #80deea;
            --accent-4: #b2ebf2;
            --accent-5: #e0f7fa;
            --grid-color: rgba(255, 255, 255, 0.05);
            --today-highlight: rgba(0, 188, 212, 0.3);
            --event-highlight: rgba(77, 208, 225, 0.3);
            --glow-effect: 0 0 15px rgba(0, 188, 212, 0.4);
            --hover-glow: 0 0 10px rgba(0, 188, 212, 0.6);
            --glow-effect-strong: 0 0 20px rgba(0, 188, 212, 0.6);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'JetBrainsMono Nerd Font', 'JetBrains Mono', monospace;
        }

        body {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: var(--background-url) no-repeat center center fixed;
            background-size: cover;
            color: var(--text-color);
            position: relative;
            overflow-x: hidden;
            font-size: 16px;
            padding: 20px;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-outer);
            z-index: -1;
        }

        .app-container {
            width: 95%;
            max-width: 1400px;
            height: 90vh;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .top-bar {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            padding: 0 20px;
        }

        .top-bar-section {
            display: flex;
        }

        .left-section {
            justify-content: flex-start;
        }

        .center-section {
            justify-content: center;
        }

        .right-section {
            justify-content: flex-end;
        }

        .active-user-display {
            background: var(--content-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 50px;
            border: 2px solid var(--accent-1);
            box-shadow: var(--glow-effect), 0 12px 40px 0 var(--content-shadow);
            padding: 8px 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .events-today-display {
            background: var(--content-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 50px;
            border: 2px solid var(--accent-1);
            box-shadow: var(--glow-effect), 0 12px 40px 0 var(--content-shadow);
            padding: 8px 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-indicator {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }

        .nav-dock {
            display: flex;
            justify-content: center;
            background: var(--content-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 50px;
            border: 3px solid var(--content-border);
            box-shadow: var(--glow-effect), 0 12px 40px 0 var(--content-shadow);
            padding: 10px;
            gap: 15px;
            margin: 0 auto;
            width: fit-content;
            max-width: 90%;
            border: 2px solid var(--accent-1);
        }

        .nav-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 50px;
            min-width: 40px;
            position: relative;
        }

        .nav-section:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-3px);
            box-shadow: var(--hover-glow);
            border: 2px solid var(--accent-1);
        }

        .nav-section.active {
            background: rgba(255, 255, 255, 0.15);
            box-shadow: var(--glow-effect-strong);
            border: 2px solid var(--accent-1);
        }

        .nav-icon {
            font-size: 1.5rem;
            color: var(--accent-2);
        }

        .nav-label {
            display: none;
        }

        .nav-tooltip {
            position: absolute;
            bottom: -35px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 100;
        }

        .nav-section:hover .nav-tooltip {
            opacity: 1;
        }

        .app-content {
            display: flex;
            flex: 1;
            gap: 20px;
            height: calc(100% - 70px);
            overflow: hidden;
            border-radius: 20px;
        }

        .tab-content {
            display: none;
            width: 100%;
            height: 100%;
            flex-direction: column;
        }

        .tab-content.active {
            display: flex;
            border-radius: 20px;
        }


        .content-window {
            background: var(--content-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 20px;
            border: 2px solid var(--accent-1);
            box-shadow: var(--glow-effect), 0 12px 40px 0 var(--content-shadow);
            overflow: hidden;
            padding: 20px;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .window-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .window-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--accent-2);
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid var(--content-border);
            color: var(--text-color);
            padding: 8px 15px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .icon-btn {
            width: 36px;
            height: 36px;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
            box-shadow: var(--hover-glow);
        }


        .calendar-views {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .calendar-view-btn {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid var(--content-border);
            border-radius: 8px;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calendar-view-btn.active {
            background: var(--accent-1);
            color: #000;
            font-weight: 600;
        }

        .calendar-view-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .calendar-container {
            flex: 1;
            overflow: auto;
            padding: 5px;
        }

        .year-view {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .year-month {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .year-month:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-3px);
            box-shadow: var(--hover-glow);
        }

        .month-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--accent-3);
        }

        .month-event-count {
            background: var(--accent-1);
            color: #000;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .year-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .nav-icon-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid var(--content-border);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2rem;
        }

        .nav-icon-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
            box-shadow: var(--hover-glow);
        }

        .month-view .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-auto-rows: minmax(100px, auto);
            gap: 8px;
        }

        .day-header {
            text-align: center;
            padding: 10px 0;
            font-weight: 600;
            color: var(--accent-3);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-day {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 10px;
            min-height: 100px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .calendar-day:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-3px);
            box-shadow: var(--hover-glow);
        }

        .day-number {
            position: absolute;
            top: 5px;
            right: 5px;
            font-weight: 600;
            font-size: 1.2rem;
            color: var(--accent-4);
        }

        .today .day-number {
            color: var(--accent-1);
        }

        .today {
            background: var(--today-highlight);
            border: 1px solid var(--accent-1);
        }

        .other-month {
            opacity: 0.5;
        }

        .events-container {
            margin-top: 30px;
            overflow-y: auto;
            max-height: calc(100% - 40px);
        }

        .event-item {
            background: var(--event-highlight);
            padding: 8px 12px;
            border-radius: 6px;
            margin-bottom: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 3px solid var(--accent-4);
        }

        .event-item:hover {
            transform: translateX(5px);
        }

        .event-time {
            font-weight: 600;
            color: var(--accent-2);
            margin-right: 8px;
        }

        .event-title {
            font-weight: 500;
        }

        .week-view {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            height: 100%;
            min-height: 500px;
        }

        .week-time-header {
            grid-column: 1;
            display: flex;
            flex-direction: column;
        }

        .week-day-header {
            padding: 10px;
            text-align: center;
            font-weight: 600;
            color: var(--accent-3);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .week-time-slot {
            padding: 5px;
            text-align: right;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            height: 60px;
            position: relative;
        }

        .week-time-slot:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .week-day {
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            overflow: hidden;
        }

        .week-day-content {
            flex: 1;
            position: relative;
        }

        .week-event {
            position: absolute;
            border-radius: 6px;
            padding: 5px;
            font-size: 0.8rem;
            background: var(--event-highlight);
            border-left: 3px solid var(--accent-4);
            cursor: pointer;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            z-index: 10;
            box-sizing: border-box;
        }

        .add-event-slot {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0;
            transition: opacity 0.2s;
            cursor: pointer;
        }

        .week-time-slot:hover .add-event-slot,
        .week-day:hover .add-event-slot {
            opacity: 1;
            background: rgba(0, 188, 212, 0.1);
        }

        .day-view {
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: auto;
        }

        .day-grid-container {
            position: relative;
            height: 1920px;
            padding-left: 80px;
            box-sizing: border-box;
        }

        .day-hour-label {
            position: absolute;
            left: 0;
            width: 80px;
            padding: 10px;
            font-weight: 600;
            color: var(--accent-3);
            z-index: 1;
        }

        .day-hour-marker {
            position: absolute;
            left: 80px;
            right: 0;
            height: 1px;
            background-color: var(--grid-color);
        }

        .day-event {
            position: absolute;
            border-radius: 6px;
            padding: 10px;
            background: var(--event-highlight);
            border-left: 4px solid var(--accent-3);
            cursor: pointer;
            z-index: 10;
            box-sizing: border-box;
            overflow: hidden;
        }

        .day-event-title {
            font-weight: 600;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .day-event-time {
            font-size: 0.9rem;
            color: var(--accent-1);
        }

        .users-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .user-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
        }

        .user-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-3px);
            box-shadow: var(--hover-glow);
        }

        .user-card.active-user {
            border: 2px solid var(--accent-1);
            box-shadow: var(--hover-glow);
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--accent-1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin: 0 auto 10px;
            color: #000;
        }

        .user-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .user-event-count {
            font-size: 0.9rem;
            color: var(--accent-3);
        }

        .templates-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
        }

        .templates-list {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .template-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            position: relative;
            border-left: 3px solid var(--accent-3);
            transition: all 0.3s ease;
        }

        .template-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-3px);
            box-shadow: var(--hover-glow);
        }

        .template-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .template-title {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--accent-2);
        }

        .template-duration {
            font-weight: 500;
            color: var(--accent-1);
        }

        .template-description {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 10px;
            font-size: 0.95rem;
        }

        .template-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .template-btn {
            padding: 5px 12px;
            border-radius: 5px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .edit-btn {
            background: var(--glow-effect-strong);
            border: 1px solid var(--accent-1);
            color: var(--accent-1);
        }

        .delete-btn {
            background: rgba(255, 82, 82, 0.2);
            border: 1px solid #ff5252;
            color: #ff5252;
        }

        .edit-btn:hover {
            background: rgba(0, 188, 212, 0.3);
        }

        .delete-btn:hover {
            background: rgba(255, 82, 82, 0.3);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            display: none;
        }

        .modal-content {
            background: var(--content-bg);
            padding: 25px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), var(--glow-effect);
            border: 1px solid var(--content-border);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.3rem;
            color: var(--accent-2);
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.5rem;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-modal:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .task-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            flex: 1;
        }

        .form-label {
            font-weight: 500;
            color: var(--accent-4);
        }

        .form-input, .form-textarea, .form-select {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 10px;
            color: var(--text-color);
            font-family: 'JetBrainsMono Nerd Font', 'JetBrains Mono', monospace;
            font-size: 0.95rem;
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-button {
            background: var(--accent-color);
            color: #000;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .form-button:hover {
            background: var(--accent-1);
            transform: translateY(-2px);
            box-shadow: var(--hover-glow);
        }

        .color-picker-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
            max-height: 50vh;
            overflow-y: auto;
            padding-right: 10px;
        }

        .color-option {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 15px;
            transition: all 0.2s ease;
        }

        .color-option:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
            box-shadow: var(--hover-glow);
        }

        .color-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .color-name {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .color-preview {
            width: 100%;
            height: 40px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .color-controls {
            display: flex;
            gap: 10px;
        }

        .color-input {
            flex: 1;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            padding: 6px;
            color: var(--text-color);
            font-family: 'JetBrainsMono Nerd Font', 'JetBrains Mono', monospace;
            font-size: 0.9rem;
        }

        .opacity-slider {
            width: 100%;
        }

        .opacity-label {
            font-size: 0.8rem;
            text-align: center;
            margin-top: 5px;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .setting-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
        }

        .setting-title {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: var(--accent-3);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .setting-title i {
            font-size: 1.2rem;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 30px;
            background: var(--content-bg);
            border: 1px solid var(--accent-1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3), var(--hover-glow);
            transform: translateX(200%);
            transition: transform 0.4s ease;
            z-index: 200;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-color: var(--accent-1);
        }

        .notification.error {
            border-color: #ff5252;
        }

        .empty-message {
            text-align: center;
            padding: 40px 20px;
            color: rgba(255, 255, 255, 0.5);
            font-style: italic;
        }

        .event-count {
            position: absolute;
            bottom: 5px;
            left: 5px;
            background: var(--accent-4);
            color: #000;
            font-size: 0.8rem;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }
        
        .modal-buttons {
            position: sticky;
            bottom: 0;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            padding: 15px 0;
            background: var(--content-bg);
            margin-top: 20px;
            z-index: 10;
        }

        .modal-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--content-border);
            color: var(--text-color);
            cursor: pointer;
            position: relative;
        }

        .modal-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .modal-btn.primary {
            background: var(--accent-color);
            color: #000;
        }

        .modal-btn .btn-tooltip {
            position: absolute;
            bottom: -35px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 1000;
        }

        .modal-btn:hover .btn-tooltip {
            opacity: 1;
        }

        .month-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            margin-top: 10px;
        }

        .month-day {
            text-align: center;
            padding: 5px;
            font-size: 0.9rem;
            border-radius: 6px;
            cursor: pointer;
        }

        .month-day.other-month {
            opacity: 0.4;
        }

        .month-day.today {
            background: var(--accent-1);
            color: #000;
            font-weight: bold;
        }

        .month-day.has-events::after {
            content: "";
            display: block;
            width: 4px;
            height: 4px;
            background: var(--accent-2);
            border-radius: 50%;
            margin: 2px auto 0;
        }

        .month-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .event-block {
            position: absolute;
            width: 95%;
            left: 2.5%;
            border-radius: 6px;
            padding: 5px;
            font-size: 0.8rem;
            background: var(--event-highlight);
            border-left: 3px solid var(--accent-4);
            cursor: pointer;
            overflow: hidden;
            z-index: 10;
        }

        .event-block-title {
            font-weight: bold;
            margin-bottom: 3px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .event-block-time {
            font-size: 0.7rem;
            color: var(--content-bg);
        }

        .template-dropdown {
            margin-bottom: 15px;
        }

        .template-select {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 10px;
            color: var(--text-color);
            font-family: 'JetBrainsMono Nerd Font', 'JetBrains Mono', monospace;
            font-size: 0.95rem;
        }

        .theme-selector {
            margin-bottom: 20px;
        }

        .save-theme-container {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent-3);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-2);
        }

        .form-select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%234dd0e1' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 16px;
            padding-right: 35px;
            appearance: none;
        }

        @media (max-width: 900px) {
            .app-content {
                flex-direction: column;
                border-radius: 20px;
            }
            .calendar-container, .templates-container {
                min-height: 50vh;
            }
            .nav-dock {
                flex-wrap: wrap;
                border-radius: 20px;
            }
            .nav-section {
                min-width: 50px;
                padding: 8px 10px;
            }
            .year-view {
                grid-template-columns: repeat(2, 1fr);
            }
            .top-bar {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            .user-events-container {
                width: 100%;
                justify-content: space-between;
            }
            .color-picker-container {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            .save-theme-container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="top-bar">
            <div class="top-bar-section left-section">
                <div class="active-user-display">
                    <div class="user-indicator" id="active-user-indicator"></div>
                    <span id="active-user-name">No active user</span>
                </div>
            </div>
            
            <div class="top-bar-section center-section">
                <div class="nav-dock">
                    <div class="nav-section" data-tab="people" title="People">
                        <i class="nav-icon fas fa-users"></i>
                        <span class="nav-tooltip">People</span>
                    </div>
                    <div class="nav-section" data-tab="templates" title="Templates">
                        <i class="nav-icon fas fa-clone"></i>
                        <span class="nav-tooltip">Templates</span>
                    </div>
                    <div class="nav-section active" data-tab="calendar" title="Calendar">
                        <i class="nav-icon fas fa-calendar-alt"></i>
                        <span class="nav-tooltip">Calendar</span>
                    </div>
                    <div class="nav-section" data-tab="settings" title="Settings">
                        <i class="nav-icon fas fa-cog"></i>
                        <span class="nav-tooltip">Settings</span>
                    </div>
                    <div class="nav-section" data-tab="colors" title="Colors">
                        <i class="nav-icon fas fa-palette"></i>
                        <span class="nav-tooltip">Colors</span>
                    </div>
                    <div class="nav-section" data-tab="config" title="Config">
                        <i class="nav-icon fas fa-code"></i>
                        <span class="nav-tooltip">Config</span>
                    </div>
                </div>
            </div>
            
            <div class="top-bar-section right-section">
                <div class="events-today-display">
                    <i class="fas fa-calendar-day"></i>
                    <span id="events-today-count">0 events today</span>
                </div>
            </div>
        </div>
        
        <div class="app-content">
            <div class="tab-content" id="people-tab">
                <div class="content-window">
                    <div class="window-header">
                        <h2 class="window-title">Manage People</h2>
                        <button class="control-btn icon-btn" id="add-user-btn" title="Add Person">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <div class="users-container" id="users-container">
                    </div>
                </div>
            </div>

            <div class="tab-content" id="templates-tab">
                <div class="content-window">
                    <div class="window-header">
                        <h2 class="window-title">Manage Templates</h2>
                        <button class="control-btn icon-btn" id="add-template-btn" title="Add Template">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <div class="templates-container">
                        <div class="templates-list" id="templates-list">
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content active" id="calendar-tab">
                <div class="content-window">
                    <div class="window-header">
                        <h2 class="window-title" id="calendar-title">Calendar</h2>
                        <div class="calendar-views">
                            <button class="calendar-view-btn" data-view="year">Year</button>
                            <button class="calendar-view-btn" data-view="month">Month</button>
                            <button class="calendar-view-btn active" data-view="week">Week</button>
                            <button class="calendar-view-btn" data-view="day">Day</button>
                        </div>
                    </div>
                    
                    <div class="calendar-container">
                        <div class="calendar-view" id="year-view" style="display: none;">
                            <div class="year-nav">
                                <button class="nav-icon-btn" id="prev-year-btn"><i class="fas fa-chevron-left"></i></button>
                                <h2 id="year-title">Show year here</h2>
                                <button class="nav-icon-btn" id="next-year-btn"><i class="fas fa-chevron-right"></i></button>
                            </div>
                            <div class="year-view" id="year-container">
                            </div>
                        </div>
                        
                        <div class="calendar-view" id="month-view" style="display: none;">
                            <div class="month-nav">
                                <button class="nav-icon-btn" id="prev-month-btn"><i class="fas fa-chevron-left"></i></button>
                                <h2 id="month-title">January 2023</h2>
                                <button class="nav-icon-btn" id="next-month-btn"><i class="fas fa-chevron-right"></i></button>
                            </div>
                            
                            <div class="calendar-grid" id="calendar-grid">
                            </div>
                        </div>
                        
                        <div class="calendar-view" id="week-view">
                            <div class="month-nav">
                                <button class="nav-icon-btn" id="prev-week-btn"><i class="fas fa-chevron-left"></i></button>
                                <h2 id="week-title">Week of Jan 1, 2023</h2>
                                <button class="nav-icon-btn" id="next-week-btn"><i class="fas fa-chevron-right"></i></button>
                            </div>
                            
                            <div class="week-view" id="week-grid">
                            </div>
                        </div>
                        
                        <div class="calendar-view" id="day-view" style="display: none;">
                            <div class="month-nav">
                                <button class="nav-icon-btn" id="prev-day-btn"><i class="fas fa-chevron-left"></i></button>
                                <h2 id="day-title">January 1, 2023</h2>
                                <button class="nav-icon-btn" id="next-day-btn"><i class="fas fa-chevron-right"></i></button>
                            </div>
                            
                            <div class="day-view" id="day-grid">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="settings-tab">
                <div class="content-window">
                    <div class="window-header">
                        <h2 class="window-title">Application Settings</h2>
                    </div>
                    
                    <div class="settings-grid">
                        <div class="setting-card">
                            <h3 class="setting-title"><i class="fas fa-calendar"></i> Date Format</h3>
                            <div class="form-group">
                                <select id="date-format" class="form-select">
                                    <option value="DD-MM-YYYY">DD-MM-YYYY (Day-Month-Year)</option>
                                    <option value="MM-DD-YYYY">MM-DD-YYYY (Month-Day-Year)</option>
                                    <option value="YYYY-MM-DD">YYYY-MM-DD (Year-Month-Day)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-title"><i class="fas fa-clock"></i> Time Format</h3>
                            <div class="form-group">
                                <select id="time-format" class="form-select">
                                    <option value="24h">24-hour format</option>
                                    <option value="12h">12-hour format (AM/PM)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-title"><i class="fas fa-user"></i> User Settings</h3>
                            <div class="form-group">
                                <label class="form-label">Default User</label>
                                <select id="default-user" class="form-select">
                                    <option value="me">Me (Primary)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-title"><i class="fas fa-bell"></i> Notifications</h3>
                            <div class="form-group">
                                <label class="form-label">Reminder Time</label>
                                <select id="reminder-time" class="form-select">
                                    <option value="5">5 minutes before</option>
                                    <option value="10">10 minutes before</option>
                                    <option value="15">15 minutes before</option>
                                    <option value="30">30 minutes before</option>
                                    <option value="60">1 hour before</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="colors-tab">
                <div class="content-window">
                    <div class="window-header">
                        <h2 class="window-title">Color Customization</h2>
                    </div>
                    
                    <div class="theme-selector">
                        <div class="form-group">
                            <label class="form-label" for="theme-select">Current Theme</label>
                            <select id="theme-select" class="form-select">
                            </select>
                        </div>
                    </div>
                    
                    <div class="save-theme-container">
                        <input type="text" id="new-theme-name" class="form-input" placeholder="New theme name">
                        <button class="form-button" id="save-theme-btn">Save as New Theme</button>
                        <button class="form-button" id="apply-theme-btn">Apply to Current Theme</button>
                        <button class="form-button" id="reset-theme-btn">Reset Theme</button>
                    </div>
                    
                    <div class="color-picker-container" id="color-picker-container">
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="config-tab">
                <div class="content-window">
                    <div class="window-header">
                        <h2 class="window-title">Configuration Editor</h2>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="config-textarea">Configuration JSON:</label>
                        <textarea id="config-textarea" class="form-textarea" style="height: 60vh;"></textarea>
                    </div>
                    
                    <div class="modal-buttons">
                        <button class="modal-btn" id="export-config" title="Export Config">
                            <i class="fas fa-download"></i>
                            <span class="btn-tooltip">Export</span>
                        </button>
                        <button class="modal-btn" id="import-config" title="Import Config">
                            <i class="fas fa-upload"></i>
                            <span class="btn-tooltip">Import</span>
                        </button>
                        <button class="modal-btn" id="cancel-config">
                            <i class="fas fa-times"></i>
                            <span class="btn-tooltip">Cancel</span>
                        </button>
                        <button class="modal-btn" id="reset-config">
                            <i class="fas fa-undo"></i>
                            <span class="btn-tooltip">Reset to Default</span>
                        </button>
                        <button class="modal-btn primary" id="save-config">
                            <i class="fas fa-save"></i>
                            <span class="btn-tooltip">Save</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="task-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add New Event</h3>
                <button class="close-modal" id="close-task-modal">&times;</button>
            </div>
            <div class="task-form">
                <div class="form-group template-dropdown">
                    <label class="form-label" for="task-template">Use Template</label>
                    <select id="task-template" class="template-select">
                        <option value="">Select a template...</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="task-title">Title</label>
                    <input type="text" id="task-title" class="form-input" placeholder="Meeting with team...">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="task-description">Description</label>
                    <textarea id="task-description" class="form-textarea" placeholder="Details about the event..."></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="task-date">Date</label>
                        <input type="date" id="task-date" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="task-start-time">Start Time</label>
                        <input type="time" id="task-start-time" class="form-input">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="task-duration">Duration (minutes)</label>
                        <input type="number" id="task-duration" class="form-input" min="15" step="15" value="60">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="task-category">Category</label>
                        <input type="text" id="task-category" class="form-input" placeholder="Work, Personal, etc.">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="task-person">Person</label>
                    <select id="task-person" class="form-select">
                        <option value="all">All</option>
                    </select>
                </div>
                
                <button class="form-button" id="save-task-btn">Save Event</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="template-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add New Template</h3>
                <button class="close-modal" id="close-template-modal">&times;</button>
            </div>
            <div class="task-form">
                <div class="form-group">
                    <label class="form-label" for="template-title">Title</label>
                    <input type="text" id="template-title" class="form-input" placeholder="Daily standup...">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="template-description">Description</label>
                    <textarea id="template-description" class="form-textarea" placeholder="Template description..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="template-duration">Duration (minutes)</label>
                    <input type="number" id="template-duration" class="form-input" min="15" step="15" value="30">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="template-category">Category</label>
                    <input type="text" id="template-category" class="form-input" placeholder="Work, Personal, etc.">
                </div>
                
                <button class="form-button" id="save-template-btn">Save Template</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="user-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add New User</h3>
                <button class="close-modal" id="close-user-modal">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label" for="user-name">Name</label>
                <input type="text" id="user-name" class="form-input" placeholder="Enter user name">
            </div>
            <div class="form-group">
                <label class="form-label" for="user-color">Color</label>
                <input type="color" id="user-color" class="form-input" value="#00bcd4">
            </div>
            <button class="form-button" id="save-user-btn">Save User</button>
        </div>
    </div>
    
    <div class="notification" id="notification">
        <span id="notification-message">Task added successfully!</span>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const calendarGrid = document.getElementById('calendar-grid');
            const calendarTitle = document.getElementById('calendar-title');
            const monthTitle = document.getElementById('month-title');
            const weekTitle = document.getElementById('week-title');
            const dayTitle = document.getElementById('day-title');
            const templatesList = document.getElementById('templates-list');
            const saveTaskBtn = document.getElementById('save-task-btn');
            const taskTitle = document.getElementById('task-title');
            const taskDescription = document.getElementById('task-description');
            const taskCategory = document.getElementById('task-category');
            const taskPerson = document.getElementById('task-person');
            const taskStartTime = document.getElementById('task-start-time');
            const taskDuration = document.getElementById('task-duration');
            const taskTemplate = document.getElementById('task-template');
            const prevMonthBtn = document.getElementById('prev-month-btn');
            const nextMonthBtn = document.getElementById('next-month-btn');
            const prevWeekBtn = document.getElementById('prev-week-btn');
            const nextWeekBtn = document.getElementById('next-week-btn');
            const prevYearBtn = document.getElementById('prev-year-btn');
            const nextYearBtn = document.getElementById('next-year-btn');
            const yearTitle = document.getElementById('year-title');
            const prevDayBtn = document.getElementById('prev-day-btn');
            const nextDayBtn = document.getElementById('next-day-btn');
            const notification = document.getElementById('notification');
            const notificationMessage = document.getElementById('notification-message');
            const usersContainer = document.getElementById('users-container');
            const addUserBtn = document.getElementById('add-user-btn');
            const userModal = document.getElementById('user-modal');
            const closeUserModal = document.getElementById('close-user-modal');
            const saveUserBtn = document.getElementById('save-user-btn');
            const userName = document.getElementById('user-name');
            const userColor = document.getElementById('user-color');
            const colorPickerContainer = document.getElementById('color-picker-container');
            const configTextarea = document.getElementById('config-textarea');
            const saveConfigBtn = document.getElementById('save-config');
            const cancelConfigBtn = document.getElementById('cancel-config');
            const resetConfigBtn = document.getElementById('reset-config');
            const navSections = document.querySelectorAll('.nav-section');
            const calendarViews = document.querySelectorAll('.calendar-view');
            const calendarViewBtns = document.querySelectorAll('.calendar-view-btn');
            const taskModal = document.getElementById('task-modal');
            const templateModal = document.getElementById('template-modal');
            const closeTaskModal = document.getElementById('close-task-modal');
            const closeTemplateModal = document.getElementById('close-template-modal');
            const addTemplateBtn = document.getElementById('add-template-btn');
            const activeUserIndicator = document.getElementById('active-user-indicator');
            const activeUserName = document.getElementById('active-user-name');
            const eventsTodayCount = document.getElementById('events-today-count');
            const taskDateInput = document.getElementById('task-date');
            const saveTemplateBtn = document.getElementById('save-template-btn');
            const templateTitle = document.getElementById('template-title');
            const templateDescription = document.getElementById('template-description');
            const templateDuration = document.getElementById('template-duration');
            const templateCategory = document.getElementById('template-category');
            const themeSelect = document.getElementById('theme-select');
            const saveThemeBtn = document.getElementById('save-theme-btn');
            const applyThemeBtn = document.getElementById('apply-theme-btn');
            const resetThemeBtn = document.getElementById('reset-theme-btn');
            const newThemeName = document.getElementById('new-theme-name');
            const exportConfigBtn = document.getElementById('export-config');
            const importConfigBtn = document.getElementById('import-config');
            
            let currentDate = new Date();
            let selectedDate = new Date();
            let editingTaskId = null;
            let editingTemplateId = null;
            let currentColorOption = null;
            let activeView = 'week';
            let activeTab = 'calendar';
            let currentWeekStart = new Date();
            currentWeekStart.setDate(currentWeekStart.getDate() - currentWeekStart.getDay()); 
            let currentDay = new Date();
            let currentTaskDate = null;
            let originalThemeValues = {};
            
            let config = {
                events: [],
                templates: [
                    { id: 'template-1', title: 'Morning Routine', description: 'Daily morning activities', duration: 60 },
                    { id: 'template-2', title: 'Team Meeting', description: 'Weekly team sync', duration: 30 },
                    { id: 'template-3', title: 'Workout Session', description: 'Gym or home exercise', duration: 90 }
                ],
                users: [
                    { id: 'user-1', name: 'Me (Primary)', color: '#00bcd4' }
                ],
                currentUser: 'user-1',
                themes: {
                    'cyan': {
                        'text': '#f0f8ff',
                        'accent': '#00bcd4',
                        'link': '#4dd0e1',
                        'outer-bg': 'rgba(30, 30, 40, 0.85)',
                        'content-bg': 'rgba(25, 25, 35, 0.8)',
                        'accent-1': '#00bcd4',
                        'accent-2': '#4dd0e1',
                        'accent-3': '#80deea',
                        'accent-4': '#b2ebf2',
                        'accent-5': '#e0f7fa',
                        'today-highlight': 'rgba(0, 188, 212, 0.3)',
                        'event-highlight': 'rgba(77, 208, 225, 0.3)'
                    },
                    'dark-blue': {
                        'text': '#e0e0e0',
                        'accent': '#64b5f6',
                        'link': '#81c784',
                        'outer-bg': 'rgba(0, 0, 30, 0.7)',
                        'content-bg': 'rgba(20, 20, 40, 0.75)',
                        'accent-1': '#2196F3',
                        'accent-2': '#64FFDA',
                        'accent-3': '#81c784',
                        'accent-4': '#64b5f6',
                        'accent-5': '#ba68c8',
                        'today-highlight': 'rgba(33, 150, 243, 0.3)',
                        'event-highlight': 'rgba(100, 255, 218, 0.3)'
                    },
                    'purple': {
                        'text': '#e0e0e0',
                        'accent': '#ba68c8',
                        'link': '#c7ff11',
                        'outer-bg': 'rgba(30, 0, 30, 0.7)',
                        'content-bg': 'rgba(40, 20, 40, 0.75)',
                        'accent-1': '#ba68c8',
                        'accent-2': '#e040fb',
                        'accent-3': '#7c4dff',
                        'accent-4': '#536dfe',
                        'accent-5': '#ff80ab',
                        'today-highlight': 'rgba(186, 104, 200, 0.3)',
                        'event-highlight': 'rgba(126, 87, 194, 0.3)'
                    }
                },
                currentTheme: 'cyan',
                background: 'https://c.tenor.com/8Vto1ubdERoAAAAd/tenor.gif',
                dateFormat: 'DD-MM-YYYY',
                timeFormat: '24h'
            };
            
            const defaultConfig = JSON.parse(JSON.stringify(config));
            
            function initApp() {
                const savedConfig = localStorage.getItem('schedulerConfig');
                if (savedConfig) {
                    try {
                        config = JSON.parse(savedConfig);
                        applyConfigColors();
                        document.documentElement.style.setProperty('--background-url', `url('${config.background}')`);
                    } catch (e) {
                        console.error("Error loading config:", e);
                    }
                }
                

                storeOriginalThemeValues();
                

                updateActiveUserDisplay();
                

                setupNavigation();
                

                setupCalendarViews();
                

                renderUsers();
                renderTemplatesList();
                renderCalendar();
                renderThemeSelector();
                renderColorPicker();
                populateTemplates();

                setupEventListeners();
            }
            

            function storeOriginalThemeValues() {
                const colorVars = [
                    '--text-color', '--accent-color', '--link-color', '--bg-outer', 
                    '--content-bg', '--content-border', '--content-shadow', '--accent-1', 
                    '--accent-2', '--accent-3', '--accent-4', '--accent-5', 
                    '--grid-color', '--today-highlight', '--event-highlight',
                    '--glow-effect', '--hover-glow', '--glow-effect-strong'
                ];
                
                colorVars.forEach(varName => {
                    originalThemeValues[varName] = getComputedStyle(document.documentElement).getPropertyValue(varName);
                });
            }
            

            function updateActiveUserDisplay() {
                const user = config.users.find(u => u.id === config.currentUser);
                if (user) {
                    activeUserIndicator.style.backgroundColor = user.color;
                    activeUserName.textContent = user.name;
                } else {
                    activeUserIndicator.style.backgroundColor = 'transparent';
                    activeUserName.textContent = 'No active user';
                }
                

                updateEventsTodayCounter();
            }
            

            function updateEventsTodayCounter() {
                const today = new Date();
                const todayEvents = config.events.filter(event => {
                    const eventDate = new Date(event.date);
                    return eventDate.toDateString() === today.toDateString() && 
                           (event.userId === config.currentUser || event.userId === 'all');
                }).length;
                
                eventsTodayCount.textContent = `${todayEvents} ${todayEvents === 1 ? 'event' : 'events'} today`;
            }
            

            function setupNavigation() {
                navSections.forEach(section => {
                    section.addEventListener('click', () => {
                        const tabId = section.dataset.tab;
                        

                        activeTab = tabId;
                        document.querySelectorAll('.tab-content').forEach(tab => {
                            tab.classList.remove('active');
                        });
                        document.getElementById(`${tabId}-tab`).classList.add('active');
                        

                        navSections.forEach(s => s.classList.remove('active'));
                        section.classList.add('active');

                        if (tabId === 'calendar') {
                            renderCalendar();
                        } else if (tabId === 'templates') {
                            renderTemplatesList();
                        } else if (tabId === 'people') {
                            renderUsers();
                        } else if (tabId === 'colors') {
                            renderThemeSelector();
                            renderColorPicker();
                        } else if (tabId === 'config') {
                            configTextarea.value = JSON.stringify(config, null, 2);
                        }
                    });
                });
            }
            

            function setupCalendarViews() {
                calendarViewBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const view = btn.dataset.view;
                        

                        activeView = view;
                        calendarViews.forEach(v => v.style.display = 'none');
                        document.getElementById(`${view}-view`).style.display = 'block';
                        

                        calendarViewBtns.forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        

                        renderCalendar();
                    });
                });
            }
            

            function setupEventListeners() {
                prevMonthBtn.addEventListener('click', () => {
                    currentDate.setMonth(currentDate.getMonth() - 1);
                    renderCalendar();
                });
                
                nextMonthBtn.addEventListener('click', () => {
                    currentDate.setMonth(currentDate.getMonth() + 1);
                    renderCalendar();
                });
                
                prevWeekBtn.addEventListener('click', () => {
                    currentWeekStart.setDate(currentWeekStart.getDate() - 7);
                    renderCalendar();
                });
                
                nextWeekBtn.addEventListener('click', () => {
                    currentWeekStart.setDate(currentWeekStart.getDate() + 7);
                    renderCalendar();
                });
                
                prevYearBtn.addEventListener('click', () => {
                    currentDate.setFullYear(currentDate.getFullYear() - 1);
                    renderCalendar();
                });
                
                nextYearBtn.addEventListener('click', () => {
                    currentDate.setFullYear(currentDate.getFullYear() + 1);
                    renderCalendar();
                });
                
                prevDayBtn.addEventListener('click', () => {
                    currentDay.setDate(currentDay.getDate() - 1);
                    renderCalendar();
                });
                
                nextDayBtn.addEventListener('click', () => {
                    currentDay.setDate(currentDay.getDate() + 1);
                    renderCalendar();
                });
                
                addTemplateBtn.addEventListener('click', () => {
                    openTemplateModal();
                });
                
                closeTaskModal.addEventListener('click', () => {
                    taskModal.style.display = 'none';
                });
                
                closeTemplateModal.addEventListener('click', () => {
                    templateModal.style.display = 'none';
                });
                
                saveTaskBtn.addEventListener('click', () => {
                    addOrUpdateEvent();
                });
                
                saveTemplateBtn.addEventListener('click', () => {
                    addOrUpdateTemplate();
                });
                
                taskTemplate.addEventListener('change', function() {
                    const templateId = this.value;
                    if (templateId) {
                        const template = config.templates.find(t => t.id === templateId);
                        if (template) {
                            taskTitle.value = template.title;
                            taskDescription.value = template.description || '';
                            taskDuration.value = template.duration || 60;
                            taskCategory.value = template.category || '';
                        }
                    }
                });
                
                addUserBtn.addEventListener('click', () => {
                    userModal.style.display = 'flex';
                });
                
                closeUserModal.addEventListener('click', () => {
                    userModal.style.display = 'none';
                });
                
                saveUserBtn.addEventListener('click', () => {
                    if (!userName.value.trim()) {
                        showNotification('Name is required', 'error');
                        return;
                    }
                    
                    const newUser = {
                        id: `user-${Date.now()}`,
                        name: userName.value.trim(),
                        color: userColor.value
                    };
                    
                    config.users.push(newUser);
                    saveConfig();
                    renderUsers();
                    populatePersonSelect();
                    userModal.style.display = 'none';
                    userName.value = '';
                    showNotification('User added successfully!', 'success');
                });
                
                saveConfigBtn.addEventListener('click', () => {
                    try {
                        const newConfig = JSON.parse(configTextarea.value);
                        config = newConfig;
                        saveConfig();
                        applyConfigColors();
                        document.documentElement.style.setProperty('--background-url', `url('${config.background}')`);
                        showNotification('Configuration updated successfully!', 'success');
                        renderCalendar();
                        renderUsers();
                        renderTemplatesList();
                        renderThemeSelector();
                        renderColorPicker();
                        updateActiveUserDisplay();
                    } catch (e) {
                        showNotification('Invalid JSON configuration: ' + e.message, 'error');
                    }
                });
                
                cancelConfigBtn.addEventListener('click', () => {
                    configTextarea.value = JSON.stringify(config, null, 2);
                });
                
                resetConfigBtn.addEventListener('click', () => {
                    config = JSON.parse(JSON.stringify(defaultConfig));
                    configTextarea.value = JSON.stringify(config, null, 2);
                    applyConfigColors();
                    document.documentElement.style.setProperty('--background-url', `url('${config.background}')`);
                    showNotification('Configuration reset to default!', 'success');
                    renderCalendar();
                    renderUsers();
                    renderTemplatesList();
                    renderThemeSelector();
                    renderColorPicker();
                    updateActiveUserDisplay();
                });
                
                themeSelect.addEventListener('change', function() {
                    config.currentTheme = this.value;
                    applyConfigColors();
                    saveConfig();
                    renderColorPicker();
                    showNotification(`Theme changed to: ${this.value}`, 'success');
                });
                
                saveThemeBtn.addEventListener('click', () => {
                    if (!newThemeName.value.trim()) {
                        showNotification('Theme name is required', 'error');
                        return;
                    }
                    
                    const themeName = newThemeName.value.trim();
                    config.themes[themeName] = {};

                    const colorVars = [
                        '--text-color', '--accent-color', '--link-color', '--bg-outer', 
                        '--content-bg', '--accent-1', '--accent-2', '--accent-3', 
                        '--accent-4', '--accent-5', '--today-highlight', '--event-highlight'
                    ];
                    
                    colorVars.forEach(varName => {
                        const value = getComputedStyle(document.documentElement).getPropertyValue(varName);
                        const key = varName.replace('--', '').replace(/-/g, '_');
                        config.themes[themeName][key] = value;
                    });
                    
                    saveConfig();
                    renderThemeSelector();
                    newThemeName.value = '';
                    showNotification(`Theme "${themeName}" saved successfully!`, 'success');
                });
                
                applyThemeBtn.addEventListener('click', () => {
                    if (!confirm('Are you sure you want to update the current theme with your changes?')) {
                        return;
                    }
                    
                    const themeName = config.currentTheme;
                    const theme = config.themes[themeName];
                    
                    const colorVars = [
                        '--text-color', '--accent-color', '--link-color', '--bg-outer', 
                        '--content-bg', '--accent-1', '--accent-2', '--accent-3', 
                        '--accent-4', '--accent-5', '--today-highlight', '--event-highlight'
                    ];
                    
                    colorVars.forEach(varName => {
                        const value = getComputedStyle(document.documentElement).getPropertyValue(varName);
                        const key = varName.replace('--', '').replace(/-/g, '_');
                        theme[key] = value;
                    });
                    
                    saveConfig();
                    showNotification(`Current theme "${themeName}" updated!`, 'success');
                });
                
                resetThemeBtn.addEventListener('click', () => {
                    if (!confirm('Are you sure you want to reset the theme to its saved state?')) {
                        return;
                    }
                    
                    applyConfigColors();
                    renderColorPicker();
                    showNotification('Theme reset to saved state', 'success');
                });
                
                exportConfigBtn.addEventListener('click', () => {
                    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(config, null, 2));
                    const downloadAnchorNode = document.createElement('a');
                    downloadAnchorNode.setAttribute("href", dataStr);
                    downloadAnchorNode.setAttribute("download", "scheduler-config.json");
                    document.body.appendChild(downloadAnchorNode);
                    downloadAnchorNode.click();
                    downloadAnchorNode.remove();
                    showNotification('Configuration exported!', 'success');
                });
                
                importConfigBtn.addEventListener('click', () => {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = '.json';
                    
                    input.onchange = e => {
                        const file = e.target.files[0];
                        const reader = new FileReader();
                        reader.readAsText(file, 'UTF-8');
                        
                        reader.onload = readerEvent => {
                            try {
                                const newConfig = JSON.parse(readerEvent.target.result);
                                config = newConfig;
                                saveConfig();
                                applyConfigColors();
                                document.documentElement.style.setProperty('--background-url', `url('${config.background}')`);
                                showNotification('Configuration imported successfully!', 'success');
                                renderCalendar();
                                renderUsers();
                                renderTemplatesList();
                                renderThemeSelector();
                                renderColorPicker();
                                updateActiveUserDisplay();
                                configTextarea.value = JSON.stringify(config, null, 2);
                            } catch (e) {
                                showNotification('Invalid JSON configuration: ' + e.message, 'error');
                            }
                        };
                    };
                    
                    input.click();
                });
                
                taskModal.addEventListener('click', (e) => {
                    if (e.target === taskModal) {
                        taskModal.style.display = 'none';
                    }
                });
                
                templateModal.addEventListener('click', (e) => {
                    if (e.target === templateModal) {
                        templateModal.style.display = 'none';
                    }
                });
                
                userModal.addEventListener('click', (e) => {
                    if (e.target === userModal) {
                        userModal.style.display = 'none';
                    }
                });
            }
            
            function renderUsers() {
                usersContainer.innerHTML = '';
                
                if (config.users.length === 0) {
                    usersContainer.innerHTML = '<div class="empty-message">No users added yet</div>';
                    return;
                }
                
                config.users.forEach(user => {
                    const userEl = document.createElement('div');
                    userEl.classList.add('user-card');
                    if (user.id === config.currentUser) {
                        userEl.classList.add('active-user');
                    }
                    
                    userEl.innerHTML = `
                        <div class="user-avatar" style="background: ${user.color}">
                            ${user.name.charAt(0)}
                        </div>
                        <div class="user-name">${user.name}</div>
                        <div class="user-event-count">${getUserEventCount(user.id)} events</div>
                    `;
                    
                    userEl.addEventListener('click', () => {
                        config.currentUser = user.id;
                        saveConfig();
                        renderUsers();
                        updateActiveUserDisplay();
                        showNotification(`Active user set to: ${user.name}`, 'success');
                    });
                    
                    usersContainer.appendChild(userEl);
                });
                
                populatePersonSelect();
            }
            
            function getUserEventCount(userId) {
                return config.events.filter(event => 
                    event.userId === userId || event.userId === 'all'
                ).length;
            }
            
            function populatePersonSelect() {
                taskPerson.innerHTML = '<option value="all">All</option>';
                config.users.forEach(user => {
                    const option = document.createElement('option');
                    option.value = user.id;
                    option.textContent = user.name;
                    taskPerson.appendChild(option);
                });
            }
            
            function populateTemplates() {
                taskTemplate.innerHTML = '<option value="">Select a template...</option>';
                config.templates.forEach(template => {
                    const option = document.createElement('option');
                    option.value = template.id;
                    option.textContent = template.title;
                    taskTemplate.appendChild(option);
                });
            }
            
            function renderTemplatesList() {
                templatesList.innerHTML = '';
                
                if (config.templates.length === 0) {
                    templatesList.innerHTML = '<div class="empty-message">No templates added yet</div>';
                    return;
                }
                
                config.templates.forEach(template => {
                    const templateEl = document.createElement('div');
                    templateEl.classList.add('template-item');
                    templateEl.dataset.id = template.id;
                    
                    templateEl.innerHTML = `
                        <div class="template-header">
                            <div class="template-title">${template.title}</div>
                            <div class="template-duration">${template.duration} mins</div>
                        </div>
                        <div class="template-description">${template.description || 'No description'}</div>
                        <div class="template-actions">
                            <button class="template-btn edit-btn">Edit</button>
                            <button class="template-btn delete-btn">Delete</button>
                        </div>
                    `;
                    
                    templateEl.querySelector('.edit-btn').addEventListener('click', (e) => {
                        e.stopPropagation();
                        editTemplate(template.id);
                    });
                    
                    templateEl.querySelector('.delete-btn').addEventListener('click', (e) => {
                        e.stopPropagation();
                        deleteTemplate(template.id);
                    });
                    
                    templatesList.appendChild(templateEl);
                });
            }
            
            function renderCalendar() {
                if (activeView === 'year') {
                    renderYearView();
                } else if (activeView === 'month') {
                    renderMonthView();
                } else if (activeView === 'week') {
                    renderWeekView();
                } else if (activeView === 'day') {
                    renderDayView();
                }
            }
            
            function renderYearView() {
                const yearContainer = document.getElementById('year-container');
                yearContainer.innerHTML = '';
                
                const year = currentDate.getFullYear();
                yearTitle.textContent = year;
                
                for (let month = 0; month < 12; month++) {
                    const monthDate = new Date(year, month, 1);
                    const monthName = monthDate.toLocaleString('default', { month: 'long' });
                    
                    const monthEl = document.createElement('div');
                    monthEl.classList.add('year-month');
                    monthEl.innerHTML = `
                        <div class="month-title">${monthName}</div>
                        <div class="month-grid" id="month-grid-${month}"></div>
                    `;
                    
                    renderMiniCalendar(monthEl.querySelector('.month-grid'), year, month);
                    
                    monthEl.addEventListener('click', () => {
                        currentDate = new Date(year, month, 1);
                        activeView = 'month';
                        document.getElementById('year-view').style.display = 'none';
                        document.getElementById('month-view').style.display = 'block';
                        calendarViewBtns.forEach(b => b.classList.remove('active'));
                        document.querySelector('[data-view="month"]').classList.add('active');
                        renderMonthView();
                    });
                    
                    yearContainer.appendChild(monthEl);
                }
            }
            

            function renderMiniCalendar(container, year, month) {
                container.innerHTML = '';
                

                const days = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
                days.forEach(day => {
                    const dayHeader = document.createElement('div');
                    dayHeader.classList.add('month-day');
                    dayHeader.textContent = day;
                    dayHeader.style.fontWeight = 'bold';
                    container.appendChild(dayHeader);
                });

                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                

                const prevMonthLastDay = new Date(year, month, 0).getDate();
                const firstDayIndex = firstDay.getDay();
                

                const daysInMonth = lastDay.getDate();
                

                for (let i = firstDayIndex - 1; i >= 0; i--) {
                    const day = document.createElement('div');
                    day.classList.add('month-day', 'other-month');
                    const dayNumber = prevMonthLastDay - i;
                    day.textContent = dayNumber;
                    container.appendChild(day);
                }
                

                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                for (let i = 1; i <= daysInMonth; i++) {
                    const day = document.createElement('div');
                    day.classList.add('month-day');
                    

                    const date = new Date(year, month, i);
                    date.setHours(0, 0, 0, 0);
                    if (date.getTime() === today.getTime()) {
                        day.classList.add('today');
                    }
                    
                    if (getEventsCountForDate(date) > 0) {
                        day.classList.add('has-events');
                    }
                    
                    day.textContent = i;
                    container.appendChild(day);
                }
            }
            

            function getEventsCountForMonth(year, month) {
                return config.events.filter(event => {
                    const eventDate = new Date(event.date);
                    return eventDate.getFullYear() === year && 
                           eventDate.getMonth() === month &&
                           (event.userId === config.currentUser || event.userId === 'all');
                }).length;
            }
            

            function renderMonthView() {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                

                monthTitle.textContent = currentDate.toLocaleString('default', { month: 'long', year: 'numeric' });
                

                calendarGrid.innerHTML = '';

                const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                days.forEach(day => {
                    const dayHeader = document.createElement('div');
                    dayHeader.classList.add('day-header');
                    dayHeader.textContent = day;
                    calendarGrid.appendChild(dayHeader);
                });
                
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                

                const prevMonthLastDay = new Date(year, month, 0).getDate();
                const firstDayIndex = firstDay.getDay();
                
                const daysInMonth = lastDay.getDate();

                let dayCount = 0;
                

                for (let i = firstDayIndex - 1; i >= 0; i--) {
                    const day = document.createElement('div');
                    day.classList.add('calendar-day', 'other-month');
                    const dayNumber = prevMonthLastDay - i;
                    day.innerHTML = `<div class="day-number">${dayNumber}</div>`;
                    calendarGrid.appendChild(day);
                    dayCount++;
                }
                

                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                for (let i = 1; i <= daysInMonth; i++) {
                    const day = document.createElement('div');
                    day.classList.add('calendar-day');
                    

                    const date = new Date(year, month, i);
                    date.setHours(0, 0, 0, 0);
                    if (date.getTime() === today.getTime()) {
                        day.classList.add('today');
                    }
                    

                    if (date.getTime() === selectedDate.getTime()) {
                        day.style.borderColor = 'var(--accent-1)';
                    }
                    
                    day.innerHTML = `<div class="day-number">${i}</div>`;
                    

                    const eventCount = getEventsCountForDate(date);
                    if (eventCount > 0) {
                        day.innerHTML += `<div class="event-count">${eventCount}</div>`;
                    }
                    
                    day.addEventListener('click', () => {
                        selectedDate = date;
                        if (activeView === 'week') {
                            activeView = 'day';
                            document.getElementById('week-view').style.display = 'none';
                            document.getElementById('day-view').style.display = 'block';
                            calendarViewBtns.forEach(b => b.classList.remove('active'));
                            document.querySelector('[data-view="day"]').classList.add('active');
                            renderDayView();
                        } else {
                            showTasksForDate(selectedDate);
                        }
                    });
                    
                    calendarGrid.appendChild(day);
                    dayCount++;
                }
                
                const nextMonthDays = 42 - dayCount; 
                for (let i = 1; i <= nextMonthDays; i++) {
                    const day = document.createElement('div');
                    day.classList.add('calendar-day', 'other-month');
                    day.innerHTML = `<div class="day-number">${i}</div>`;
                    calendarGrid.appendChild(day);
                }
            }
            
            function renderWeekView() {
                const weekGrid = document.getElementById('week-grid');
                weekGrid.innerHTML = '';
                

                const startDate = new Date(currentWeekStart);
                startDate.setHours(0,0,0,0);

                const endDate = new Date(startDate);
                endDate.setDate(startDate.getDate() + 6);
                weekTitle.textContent = `Week of ${formatDate(startDate)} - ${formatDate(endDate)}`;

                const timeHeader = document.createElement('div');
                timeHeader.classList.add('week-time-header');
                timeHeader.innerHTML = '<div class="week-day-header">Time</div>';
                

                for (let hour = 0; hour < 24; hour++) {
                    const timeSlot = document.createElement('div');
                    timeSlot.classList.add('week-time-slot');
                    timeSlot.textContent = `${hour.toString().padStart(2, '0')}:00`;
                    

                    const addSlot = document.createElement('div');
                    addSlot.classList.add('add-event-slot');
                    addSlot.addEventListener('click', () => {
                        const date = new Date(startDate);
                        date.setHours(hour, 0, 0, 0);
                        openTaskModal(null, date);
                    });
                    
                    timeSlot.appendChild(addSlot);
                    timeHeader.appendChild(timeSlot);
                }
                
                weekGrid.appendChild(timeHeader);
                

                for (let i = 0; i < 7; i++) {
                    const dayDate = new Date(startDate);
                    dayDate.setDate(startDate.getDate() + i);
                    
                    const dayCol = document.createElement('div');
                    dayCol.classList.add('week-day');
                    

                    const dayHeader = document.createElement('div');
                    dayHeader.classList.add('week-day-header');
                    dayHeader.innerHTML = `
                        <div>${dayDate.toLocaleString('default', { weekday: 'short' })}</div>
                        <div>${dayDate.getDate()}</div>
                    `;
                    

                    const today = new Date();
                    if (dayDate.toDateString() === today.toDateString()) {
                        dayHeader.style.backgroundColor = 'var(--today-highlight)';
                    }
                    
                    dayCol.appendChild(dayHeader);
                    

                    const dayContent = document.createElement('div');
                    dayContent.classList.add('week-day-content');
                    dayContent.style.position = 'relative';
                    dayContent.style.height = '1440px'; 
                    

                    for (let h = 0; h < 24; h++) {
                        const hourSlot = document.createElement('div');
                        hourSlot.classList.add('week-hour-slot');
                        hourSlot.style.height = '60px';
                        hourSlot.style.borderTop = '1px solid var(--grid-color)';
                        hourSlot.style.position = 'relative';


                        const addSlot = document.createElement('div');
                        addSlot.classList.add('add-event-slot');
                        addSlot.style.position = 'absolute';
                        addSlot.style.top = '0';
                        addSlot.style.left = '0';
                        addSlot.style.width = '100%';
                        addSlot.style.height = '100%';
                        addSlot.style.opacity = '0';
                        addSlot.addEventListener('click', (e) => {
                            const rect = hourSlot.getBoundingClientRect();
                            const offsetY = e.clientY - rect.top;
                            const minutes = Math.floor(offsetY); 
                            const hour = h;
                            const minute = minutes;

                            const date = new Date(dayDate);
                            date.setHours(hour, minute, 0, 0);

                            openTaskModal(null, date);
                        });

                        hourSlot.appendChild(addSlot);
                        dayContent.appendChild(hourSlot);
                    }
                    
                    const events = getEventsForDate(dayDate);
                    

                    events.sort((a, b) => {
                        const aTime = a.startTime ? a.startTime.split(':').map(Number) : [0,0];
                        const bTime = b.startTime ? b.startTime.split(':').map(Number) : [0,0];
                        return (aTime[0]*60+aTime[1]) - (bTime[0]*60+bTime[1]);
                    });

                    let lanes = [];
                    let maxLanes = 0;

                    events.forEach(event => {
                        if (!event.startTime) return;

                        const [hours, minutes] = event.startTime.split(':').map(Number);
                        const startMinute = hours * 60 + minutes;
                        const duration = event.duration || 60;
                        const endMinute = startMinute + duration;

                        let laneIndex = 0;
                        while (laneIndex < lanes.length) {
                            if (lanes[laneIndex] <= startMinute) {
                                break;
                            }
                            laneIndex++;
                        }

                        if (laneIndex === lanes.length) {
                            lanes.push(endMinute);
                        } else {
                            lanes[laneIndex] = endMinute;
                        }

                        event.lane = laneIndex;
                        event.lanesCount = lanes.length;
                        if (lanes.length > maxLanes) maxLanes = lanes.length;
                    });

                    events.forEach(event => {
                        if (!event.startTime) return;
                        
                        const eventEl = document.createElement('div');
                        eventEl.classList.add('week-event');
                        

                        const [hours, minutes] = event.startTime.split(':').map(Number);
                        const top = (hours * 60 + minutes); 
                        const height = (event.duration || 60); 
                        
                        const laneWidth = 95 / maxLanes;
                        const left = 2.5 + event.lane * laneWidth;
                        
                        eventEl.style.top = `${top}px`;
                        eventEl.style.height = `${height}px`;
                        eventEl.style.left = `${left}%`;
                        eventEl.style.width = `${laneWidth}%`;
                        
                        const user = config.users.find(u => u.id === event.userId) || config.users[0];
                        
                        eventEl.style.color = '#000';
                        eventEl.innerHTML = `
                            <div class="event-block-title">${event.title}</div>
                            <div class="event-block-time">${event.startTime} (${event.duration} mins)</div>
                        `;
                        
                        eventEl.addEventListener('click', (e) => {
                            e.stopPropagation();
                            editEvent(event.id);
                        });
                        
                        dayContent.appendChild(eventEl);
                    });
                    
                    dayCol.appendChild(dayContent);
                    weekGrid.appendChild(dayCol);
                }
            }

            function renderDayView() {
                const dayGrid = document.getElementById('day-grid');
                dayGrid.innerHTML = '';
                

                dayTitle.textContent = formatDate(currentDay);
                

                const container = document.createElement('div');
                container.className = 'day-grid-container';
                

                for (let hour = 0; hour < 24; hour++) {
                    const hourLabel = document.createElement('div');
                    hourLabel.className = 'day-hour-label';
                    hourLabel.textContent = `${hour.toString().padStart(2, '0')}:00`;
                    hourLabel.style.top = `${hour * 80}px`;
                    container.appendChild(hourLabel);
                    
                    const hourMarker = document.createElement('div');
                    hourMarker.className = 'day-hour-marker';
                    hourMarker.style.top = `${hour * 80}px`;
                    container.appendChild(hourMarker);
                }
                

                const events = getEventsForDate(currentDay);
                

                events.sort((a, b) => {
                    const aTime = a.startTime ? a.startTime.split(':').map(Number) : [0,0];
                    const bTime = b.startTime ? b.startTime.split(':').map(Number) : [0,0];
                    return (aTime[0]*60+aTime[1]) - (bTime[0]*60+bTime[1]);
                });

                let lanes = []; 
                let maxLanes = 0;

                events.forEach(event => {
                    if (!event.startTime) return;

                    const [hours, minutes] = event.startTime.split(':').map(Number);
                    const startMinute = hours * 60 + minutes;
                    const duration = event.duration || 60;
                    const endMinute = startMinute + duration;

                    let laneIndex = 0;
                    while (laneIndex < lanes.length) {
                        if (lanes[laneIndex] <= startMinute) {
                            break;
                        }
                        laneIndex++;
                    }

                    if (laneIndex === lanes.length) {
                        lanes.push(endMinute);
                    } else {
                        lanes[laneIndex] = endMinute;
                    }

                    event.lane = laneIndex;
                    event.lanesCount = lanes.length;
                    if (lanes.length > maxLanes) maxLanes = lanes.length;
                });

                events.forEach(event => {
                    if (!event.startTime) return;
                    
                    const eventEl = document.createElement('div');
                    eventEl.classList.add('day-event');
                    

                    const [hours, minutes] = event.startTime.split(':').map(Number);
                    const top = (hours * 60 + minutes) * (80/60); 
                    const height = (event.duration || 60) * (80/60); 
                    
                    const laneWidth = 90 / maxLanes;
                    const left = (event.lane * laneWidth) + 5; 
                    
                    eventEl.style.top = `${top}px`;
                    eventEl.style.height = `${height}px`;
                    eventEl.style.left = `${left}%`;
                    eventEl.style.width = `${laneWidth}%`;
                    

                    const user = config.users.find(u => u.id === event.userId) || config.users[0];
                    
                    eventEl.style.color = '#000';
                    eventEl.innerHTML = `
                        <div class="day-event-title">${event.title}</div>
                        <div class="day-event-time">${event.startTime} (${event.duration} mins)</div>
                    `;
                    
                    eventEl.addEventListener('click', () => {
                        editEvent(event.id);
                    });
                    
                    container.appendChild(eventEl);
                });
                
                dayGrid.appendChild(container);
            }
            

            function getEventsForDate(date) {
                const dateStr = formatDate(date, 'YYYY-MM-DD');
                return config.events.filter(event => 
                    event.date === dateStr && 
                    (event.userId === config.currentUser || event.userId === 'all')
                );
            }
            

            function getEventsCountForDate(date) {
                return getEventsForDate(date).length;
            }
            

            function openTaskModal(event = null, date = null) {
                taskModal.style.display = 'flex';
                editingTaskId = event ? event.id : null;
                

                taskTitle.value = event ? event.title : '';
                taskDescription.value = event ? event.description || '' : '';
                taskCategory.value = event ? event.category || '' : '';
                taskPerson.value = event ? event.userId : config.currentUser;
                taskTemplate.value = '';
                

                if (date) {
                    taskDateInput.value = formatDate(date, 'YYYY-MM-DD');
                    const hours = date.getHours().toString().padStart(2, '0');
                    const minutes = date.getMinutes().toString().padStart(2, '0');
                    taskStartTime.value = `${hours}:${minutes}`;
                } else if (event) {
                    taskDateInput.value = event.date;
                    taskStartTime.value = event.startTime || '';
                } else {
                    const today = new Date();
                    taskDateInput.value = formatDate(today, 'YYYY-MM-DD');
                    taskStartTime.value = '';
                }
                

                taskDuration.value = event ? event.duration || 60 : 60;
                

                saveTaskBtn.textContent = event ? 'Update Event' : 'Save Event';
            }
            

            function openTemplateModal(template = null) {
                templateModal.style.display = 'flex';
                editingTemplateId = template ? template.id : null;
                

                templateTitle.value = template ? template.title : '';
                templateDescription.value = template ? template.description || '' : '';
                templateDuration.value = template ? template.duration || 60 : 60;
                templateCategory.value = template ? template.category || '' : '';
                

                saveTemplateBtn.textContent = template ? 'Update Template' : 'Save Template';
            }
            

            function addOrUpdateEvent() {
                if (!taskTitle.value.trim()) {
                    showNotification('Title is required', 'error');
                    return;
                }
                
                if (!taskDateInput.value) {
                    showNotification('Date is required', 'error');
                    return;
                }
                
                const event = {
                    id: editingTaskId || `event-${Date.now()}`,
                    title: taskTitle.value.trim(),
                    description: taskDescription.value.trim(),
                    category: taskCategory.value.trim(),
                    userId: taskPerson.value === 'all' ? 'all' : taskPerson.value,
                    date: taskDateInput.value,
                    startTime: taskStartTime.value,
                    duration: parseInt(taskDuration.value) || 60
                };
                
                if (editingTaskId) {

                    const index = config.events.findIndex(e => e.id === editingTaskId);
                    if (index !== -1) {
                        config.events[index] = event;
                    }
                    showNotification('Event updated successfully!', 'success');
                } else {

                    config.events.push(event);
                    showNotification('Event added successfully!', 'success');
                }
                

                saveConfig();
                

                taskModal.style.display = 'none';
                

                renderCalendar();
                updateEventsTodayCounter();
            }
            

            function addOrUpdateTemplate() {
                if (!templateTitle.value.trim()) {
                    showNotification('Title is required', 'error');
                    return;
                }
                
                const template = {
                    id: editingTemplateId || `template-${Date.now()}`,
                    title: templateTitle.value.trim(),
                    description: templateDescription.value.trim(),
                    duration: parseInt(templateDuration.value) || 60,
                    category: templateCategory.value.trim()
                };
                
                if (editingTemplateId) {

                    const index = config.templates.findIndex(t => t.id === editingTemplateId);
                    if (index !== -1) {
                        config.templates[index] = template;
                    }
                    showNotification('Template updated successfully!', 'success');
                } else {
                    config.templates.push(template);
                    showNotification('Template added successfully!', 'success');
                }
                

                saveConfig();
                

                templateModal.style.display = 'none';
                

                renderTemplatesList();
                populateTemplates();
            }
            

            function editEvent(eventId) {
                const event = config.events.find(e => e.id === eventId);
                if (!event) return;
                
                openTaskModal(event);
            }
            

            function editTemplate(templateId) {
                const template = config.templates.find(t => t.id === templateId);
                if (!template) return;
                
                openTemplateModal(template);
            }
            

            function deleteEvent(eventId) {
                if (confirm('Are you sure you want to delete this event?')) {
                    config.events = config.events.filter(event => event.id !== eventId);
                    saveConfig();
                    showNotification('Event deleted successfully!', 'success');
                    renderCalendar();
                    updateEventsTodayCounter();
                }
            }
            
            function deleteTemplate(templateId) {
                if (confirm('Are you sure you want to delete this template?')) {
                    config.templates = config.templates.filter(template => template.id !== templateId);
                    saveConfig();
                    showNotification('Template deleted successfully!', 'success');
                    renderTemplatesList();
                    populateTemplates();
                }
            }
            
            function renderThemeSelector() {
                themeSelect.innerHTML = '';
                for (const theme in config.themes) {
                    const option = document.createElement('option');
                    option.value = theme;
                    option.textContent = theme;
                    if (theme === config.currentTheme) {
                        option.selected = true;
                    }
                    themeSelect.appendChild(option);
                }
            }
            
            function renderColorPicker() {
                colorPickerContainer.innerHTML = '';
                
                const colorOptions = [
                    { name: 'Text Color', var: '--text-color' },
                    { name: 'Accent Color', var: '--accent-color' },
                    { name: 'Link Color', var: '--link-color' },
                    { name: 'Outer Background', var: '--bg-outer' },
                    { name: 'Content Background', var: '--content-bg' },
                    { name: 'Content Border', var: '--content-border' },
                    { name: 'Content Shadow', var: '--content-shadow' },
                    { name: 'Accent 1', var: '--accent-1' },
                    { name: 'Accent 2', var: '--accent-2' },
                    { name: 'Accent 3', var: '--accent-3' },
                    { name: 'Accent 4', var: '--accent-4' },
                    { name: 'Accent 5', var: '--accent-5' },
                    { name: 'Grid Color', var: '--grid-color' },
                    { name: 'Today Highlight', var: '--today-highlight' },
                    { name: 'Event Highlight', var: '--event-highlight' },
                    { name: 'Glow Effect', var: '--glow-effect' },
                    { name: 'Hover Glow', var: '--hover-glow' },
                    { name: 'Strong Glow Effect', var: '--glow-effect-strong' }
                ];
                
                colorOptions.forEach(option => {
                    const colorValue = getComputedStyle(document.documentElement).getPropertyValue(option.var);
                    const [r, g, b, a] = parseRGBA(colorValue);
                    
                    const colorEl = document.createElement('div');
                    colorEl.classList.add('color-option');
                    
                    colorEl.innerHTML = `
                        <div class="color-header">
                            <div class="color-name">${option.name}</div>
                        </div>
                        <div class="color-preview" style="background: ${colorValue}">
                            <span>${colorValue}</span>
                        </div>
                        <div class="form-group">
                            <input type="color" class="color-input" value="${rgbToHex(r, g, b)}" data-var="${option.var}">
                        </div>
                        <div class="form-group">
                            <input type="range" class="opacity-slider" min="0" max="100" value="${a * 100}">
                            <div class="opacity-label">Opacity: ${Math.round(a * 100)}%</div>
                        </div>
                    `;
                    
                    const colorInput = colorEl.querySelector('.color-input');
                    const opacitySlider = colorEl.querySelector('.opacity-slider');
                    const opacityLabel = colorEl.querySelector('.opacity-label');
                    const preview = colorEl.querySelector('.color-preview');
                    
                    colorInput.addEventListener('input', () => {
                        const opacity = opacitySlider.value / 100;
                        const newColor = hexToRGBA(colorInput.value, opacity);
                        document.documentElement.style.setProperty(option.var, newColor);
                        preview.style.background = newColor;
                        preview.innerHTML = `<span>${newColor}</span>`;
                    });
                    
                    opacitySlider.addEventListener('input', () => {
                        const opacity = opacitySlider.value / 100;
                        opacityLabel.textContent = `Opacity: ${opacitySlider.value}%`;
                        const newColor = hexToRGBA(colorInput.value, opacity);
                        document.documentElement.style.setProperty(option.var, newColor);
                        preview.style.background = newColor;
                        preview.innerHTML = `<span>${newColor}</span>`;
                    });
                    
                    colorPickerContainer.appendChild(colorEl);
                });
            }
            
            function parseRGBA(rgba) {
                const match = rgba.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);
                if (match) {
                    const r = parseInt(match[1]);
                    const g = parseInt(match[2]);
                    const b = parseInt(match[3]);
                    const a = match[4] ? parseFloat(match[4]) : 1;
                    return [r, g, b, a];
                }
                return [0, 0, 0, 1];
            }
            
            function rgbToHex(r, g, b) {
                return '#' + [r, g, b].map(x => {
                    const hex = x.toString(16);
                    return hex.length === 1 ? '0' + hex : hex;
                }).join('');
            }
            
            function hexToRGBA(hex, opacity) {
                let r = 0, g = 0, b = 0;
                
                if (hex.length === 4) {
                    r = parseInt(hex[1] + hex[1], 16);
                    g = parseInt(hex[2] + hex[2], 16);
                    b = parseInt(hex[3] + hex[3], 16);
                }
                else if (hex.length === 7) {
                    r = parseInt(hex[1] + hex[2], 16);
                    g = parseInt(hex[3] + hex[4], 16);
                    b = parseInt(hex[5] + hex[6], 16);
                }
                
                return `rgba(${r}, ${g}, ${b}, ${opacity})`;
            }
            
            function applyConfigColors() {
                const theme = config.themes[config.currentTheme];
                for (const [option, value] of Object.entries(theme)) {
                    const cssVar = '--' + option.replace(/_/g, '-');
                    document.documentElement.style.setProperty(cssVar, value);
                }
            }
            
            function showNotification(message, type = 'success') {
                notificationMessage.textContent = message;
                notification.className = 'notification ' + type + ' show';
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
            
            function saveConfig() {
                localStorage.setItem('schedulerConfig', JSON.stringify(config));
            }
            
            function formatDate(date, format = null) {
                if (!format) format = config.dateFormat;
                
                const year = date.getFullYear();
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const day = date.getDate().toString().padStart(2, '0');
                
                switch (format) {
                    case 'DD-MM-YYYY': return `${day}-${month}-${year}`;
                    case 'MM-DD-YYYY': return `${month}-${day}-${year}`;
                    case 'YYYY-MM-DD': return `${year}-${month}-${day}`;
                    default: return `${day}-${month}-${year}`;
                }
            }
            
            initApp();
        });
    </script>
</body>
</html>
